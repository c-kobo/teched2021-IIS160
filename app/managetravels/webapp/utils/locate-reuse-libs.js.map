{"version":3,"file":"locate-reuse-libs.js","names":["sap","fioriToolsGetManifestLibs","manifestPath","url","result","ui5Libs","getKeys","libOrComp","libOrCompKeysString","Object","keys","forEach","libOrCompKey","some","substring","startsWith","length","Promise","resolve","reject","$","ajax","done","manifest","dependencies","libs","components","componentUsages","fail","error","Error","registerComponentDependencyPaths","then","sapClient","jQuery","getUriParameters","get","data","moduleDefinitionKey","moduleDefinition","dependency","type","log","info","componentId","registerModulePath","scripts","document","getElementsByTagName","currentScript","manifestUri","getAttribute","componentName","useMockserver","catch","finally","ui","getCore","attachInit","require","sLocale","getConfiguration","getLanguage","oBundle","resources","locale","title","getText","replace","server","init","ushell","Container","createRenderer","placeAt"],"sources":["../../src/utils/locate-reuse-libs.js"],"sourcesContent":["/*eslint-disable semi, no-console*/\n(function (sap) {\n  var fioriToolsGetManifestLibs = function (manifestPath) {\n    var url = manifestPath;\n    var result = \"\"; // SAPUI5 delivered namespaces from https://ui5.sap.com/#/api/sap\n\n    var ui5Libs = [\"sap.apf\", \"sap.base\", \"sap.chart\", \"sap.collaboration\", \"sap.f\", \"sap.fe\", \"sap.fileviewer\", \"sap.gantt\", \"sap.landvisz\", \"sap.m\", \"sap.ndc\", \"sap.ovp\", \"sap.rules\", \"sap.suite\", \"sap.tnt\", \"sap.ui\", \"sap.uiext\", \"sap.ushell\", \"sap.uxap\", \"sap.viz\", \"sap.webanalytics\", \"sap.zen\"];\n\n    function getKeys(libOrComp, libOrCompKeysString) {\n      Object.keys(libOrComp).forEach(function (libOrCompKey) {\n        // ignore libs or Components that start with SAPUI5 delivered namespaces\n        if (!ui5Libs.some(function (substring) {\n          return libOrCompKey === substring || libOrCompKey.startsWith(substring + \".\");\n        })) {\n          if (libOrCompKeysString.length > 0) {\n            libOrCompKeysString = libOrCompKeysString + \",\" + libOrCompKey;\n          } else {\n            libOrCompKeysString = libOrCompKey;\n          }\n        }\n      });\n      return libOrCompKeysString;\n    }\n\n    return new Promise(function (resolve, reject) {\n      $.ajax(url).done(function (manifest) {\n        if (manifest) {\n          if (manifest[\"sap.ui5\"] && manifest[\"sap.ui5\"].dependencies) {\n            if (manifest[\"sap.ui5\"].dependencies.libs) {\n              result = getKeys(manifest[\"sap.ui5\"].dependencies.libs, result);\n            }\n\n            if (manifest[\"sap.ui5\"].dependencies.components) {\n              result = getKeys(manifest[\"sap.ui5\"].dependencies.components, result);\n            }\n          }\n\n          if (manifest[\"sap.ui5\"] && manifest[\"sap.ui5\"].componentUsages) {\n            result = getKeys(manifest[\"sap.ui5\"].componentUsages, result);\n          }\n        }\n\n        resolve(result);\n      }).fail(function (error) {\n        reject(new Error(\"Could not fetch manifest at '\" + manifestPath));\n      });\n    });\n  };\n  /**\n   * Registers the module paths for dependencies of the given component.\n   * @param {string} manifestPath The the path to the app manifest path\n   * for which the dependencies should be registered.\n   * @returns {Promise} A promise which is resolved when the ajax request for\n   * the app-index was successful and the module paths were registered.\n   */\n\n\n  sap.registerComponentDependencyPaths = function (manifestPath) {\n    /*eslint-disable semi, consistent-return*/\n    return fioriToolsGetManifestLibs(manifestPath).then(function (libs) {\n      if (libs && libs.length > 0) {\n        var url = \"/sap/bc/ui2/app_index/ui5_app_info?id=\" + libs;\n        var sapClient = jQuery.sap.getUriParameters().get(\"sap-client\");\n\n        if (sapClient && sapClient.length === 3) {\n          url = url + \"&sap-client=\" + sapClient;\n        }\n\n        return $.ajax(url).done(function (data) {\n          if (data) {\n            Object.keys(data).forEach(function (moduleDefinitionKey) {\n              var moduleDefinition = data[moduleDefinitionKey];\n\n              if (moduleDefinition && moduleDefinition.dependencies) {\n                moduleDefinition.dependencies.forEach(function (dependency) {\n                  if (dependency.url && dependency.url.length > 0 && dependency.type === \"UI5LIB\") {\n                    jQuery.sap.log.info(\"Registering Library \" + dependency.componentId + \" from server \" + dependency.url);\n                    jQuery.sap.registerModulePath(dependency.componentId, dependency.url);\n                  }\n                });\n              }\n            });\n          }\n        });\n      }\n    });\n  };\n})(sap);\n/*eslint-disable sap-browser-api-warning, sap-no-dom-access*/\n\n\nvar scripts = document.getElementsByTagName(\"script\");\nvar currentScript = scripts[scripts.length - 1];\nvar manifestUri = currentScript.getAttribute(\"data-sap-ui-manifest-uri\");\nvar componentName = currentScript.getAttribute(\"data-sap-ui-componentName\");\nvar useMockserver = currentScript.getAttribute(\"data-sap-ui-use-mockserver\");\nsap.registerComponentDependencyPaths(manifestUri).catch(function (error) {\n  jQuery.sap.log.error(error);\n}).finally(function () {\n  // setting the app title with internationalization \n  sap.ui.getCore().attachInit(function () {\n    jQuery.sap.require(\"jquery.sap.resources\");\n\n    var sLocale = sap.ui.getCore().getConfiguration().getLanguage();\n    var oBundle = jQuery.sap.resources({\n      url: \"i18n/i18n.properties\",\n      locale: sLocale\n    });\n    document.title = oBundle.getText(\"appTitle\");\n  });\n\n  if (componentName && componentName.length > 0) {\n    if (useMockserver && useMockserver === \"true\") {\n      sap.ui.getCore().attachInit(function () {\n        sap.ui.require([componentName.replace(/\\./g, \"/\") + \"/localService/mockserver\"], function (server) {\n          // set up test service for local testing\n          server.init(); // initialize the ushell sandbox component\n\n          sap.ushell.Container.createRenderer().placeAt(\"content\");\n        });\n      });\n    } else {\n      // Requiring the ComponentSupport module automatically executes the component initialisation for all declaratively defined components\n      sap.ui.require([\"sap/ui/core/ComponentSupport\"]); // setting the app title with the i18n text \n\n\n      sap.ui.getCore().attachInit(function () {\n        jQuery.sap.require(\"jquery.sap.resources\");\n\n        var sLocale = sap.ui.getCore().getConfiguration().getLanguage();\n        var oBundle = jQuery.sap.resources({\n          url: \"i18n/i18n.properties\",\n          locale: sLocale\n        });\n        document.title = oBundle.getText(\"appTitle\");\n      });\n    }\n  } else {\n    sap.ui.getCore().attachInit(function () {\n      // initialize the ushell sandbox component\n      sap.ushell.Container.createRenderer().placeAt(\"content\");\n    });\n  }\n});\nsap.registerComponentDependencyPaths(manifestUri);"],"mappings":"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"}